<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Meta tags for social media banners, these should be filled in appropriatly as they are your "business card" -->
  <!-- Replace the content tag with appropriate information -->
  <meta name="description" content="DESCRIPTION META TAG">
  <meta property="og:title" content="SOCIAL MEDIA TITLE TAG"/>
  <meta property="og:description" content="SOCIAL MEDIA DESCRIPTION TAG TAG"/>
  <meta property="og:url" content="URL OF THE WEBSITE"/>
  <!-- Path to banner image, should be in the path listed below. Optimal dimenssions are 1200X630-->
  <meta property="og:image" content="static/image/your_banner_image.png" />
  <meta property="og:image:width" content="1200"/>
  <meta property="og:image:height" content="630"/>


  <meta name="twitter:title" content="TWITTER BANNER TITLE META TAG">
  <meta name="twitter:description" content="TWITTER BANNER DESCRIPTION META TAG">
  <!-- Path to banner image, should be in the path listed below. Optimal dimenssions are 1200X600-->
  <meta name="twitter:image" content="static/images/your_twitter_banner_image.png">
  <meta name="twitter:card" content="summary_large_image">
  <!-- Keywords for your paper to be indexed by-->
  <meta name="keywords" content="KEYWORDS SHOULD BE PLACED HERE">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <title>The Crystal Ball Hypothesis in diffusion models: Anticipating object positions from initial noise</title>
  <link rel="icon" type="image/x-icon" href="static/images/favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
  rel="stylesheet">

  <link rel="stylesheet" href="static/css/bulma.min.css">
  <link rel="stylesheet" href="static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="static/css/index.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://documentcloud.adobe.com/view-sdk/main.js"></script>
  <script defer src="static/js/fontawesome.all.min.js"></script>
  <script src="static/js/bulma-carousel.min.js"></script>
  <script src="static/js/bulma-slider.min.js"></script>
  <script src="static/js/index.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>


  <section class="hero">
    <div class="hero-body">
      <div class="container is-max-desktop">
        <div class="columns is-centered">
          <div class="column has-text-centered">
            <h1 class="title is-1 publication-title">The Crystal Ball Hypothesis in diffusion models: Anticipating object positions from initial noise</h1>
            <div class="is-size-5 publication-authors">
              <!-- Paper authors -->
              <span class="author-block">
                <a href="https://github.com/banyuanhao" target="_blank">Yuanhao Ban</a>,</span>
                <span class="author-block">
                  <a href="https://ruocwang.github.io/" target="_blank">Ruochen Wang</a>,</span>
                  <span class="author-block">
                    <a href="https://tianyizhou.github.io/" target="_blank">Tianyi Zhou</a>,
                  </span>
                  <a href="http://boqinggong.info/ target="_blank">Boqing Gong</a>,
                  </span>
                  <a href="https://web.cs.ucla.edu/~chohsieh/" target="_blank">Cho-Jui Hsieh</a>,
                  </span>
                  <a href="https://cmhcbb.github.io/" target="_blank">Minhao Cheng</a>
                  </span>
                  </div>

                  <div class="is-size-5 publication-authors">
                    <span class="author-block">UCLA - UMD - Google - PSU<br>Submitted to NeurIPS 2024</span>
                  </div>

                  <div class="arc-collaboration">
                    <span style="font-size: 24px; color: red;">A</span><span style="font-size: 20px;">IGC </span>
                    <span style="font-size: 24px; color: red;">R</span><span style="font-size: 20px;">esearch </span>
                    <span style="font-size: 24px; color: red;">C</span><span style="font-size: 20px;">ollaboration</span>
                </div>
                
                  <div class="column has-text-centered">
                    <div class="publication-links">
                         <!-- Arxiv PDF link -->
                      <span class="link-block">
                        <a href="https://arxiv.org/pdf/2406.01970.pdf" target="_blank"
                        class="external-link button is-normal is-rounded is-dark">
                        <span class="icon">
                          <i class="fas fa-file-pdf"></i>
                        </span>
                        <span>Paper</span>
                      </a>
                    </span>


                  <!-- Github link -->
                  <span class="link-block">
                    <a href="https://github.com/odfn" target="_blank"
                    class="external-link button is-normal is-rounded is-dark">
                    <span class="icon">
                      <i class="fab fa-github"></i>
                    </span>
                    <span>Code</span>
                  </a>
                </span>

                <!-- ArXiv abstract Link -->
                <span class="link-block">
                  <a href="https://arxiv.org/abs/2406.01970" target="_blank"
                  class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="ai ai-arxiv"></i>
                  </span>
                  <span>arXiv</span>
                </a>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div style="width: 70%; margin: auto;">
<p> We discover the existence of trigger patches -- distinct patches in the noise space that trigger the generation of objects in the diffusion model. By moving the trigger patch to a different position, the corresponding object will likely move to that location. Furthermore, this trigger effect also exists across various promptsâ€”the same trigger patch can initiate the generation of different objects, depending on the given prompt. As illustrated in the following figure, when replacing the target patch within another initial noise with the trigger patch, the injection position would generate an object.The first row shows images generated from one seed. And we can identify the ``trigger patch'' located in the red box that tend to induce the generation of the object. If we inject the trigger patch into another noise, there will be objects in the position of the injection place in the images generated by the mixed noise.</p>
</div>
<img src="static/images/illu_backup.png" alt="Illustration of Trigger patch" style="display: block; margin: auto; width:70%; height:auto;">

<!-- Teaser video-->
<!-- <section class="hero teaser">
  <div class="container is-max-desktop">
    <div class="hero-body">
      <video poster="" id="tree" autoplay controls muted loop height="100%">
        <source src="static/videos/banner_video.mp4"
        type="video/mp4">
      </video>
      <h2 class="subtitle has-text-centered">
        Aliquam vitae elit ullamcorper tellus egestas pellentesque. Ut lacus tellus, maximus vel lectus at, placerat pretium mi. Maecenas dignissim tincidunt vestibulum. Sed consequat hendrerit nisl ut maximus. 
      </h2>
    </div>
  </div>
</section> -->
<!-- End teaser video -->

<!-- Paper abstract -->
<section class="section hero is-light">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            Diffusion models have achieved remarkable success in text-to-image generation tasks; however, the role of initial noise has been rarely explored. In this study, we identify specific regions within the initial noise image, termed trigger patches, that play a key role for object generation in the resulting images. Notably, these patches are ``universal'' and can be generalized across various positions, seeds, and prompts. To be specific, extracting these patches from one noise and injecting them into another noise leads to object generation in targeted areas. We identify these patches by analyzing the dispersion of object bounding boxes across generated images, leading to the development of a posterior analysis technique.  Furthermore, we create a dataset consisting of Gaussian noises labeled with bounding boxes corresponding to the objects appearing in the generated images and train a detector that identifies these patches from the initial noise. To explain the formation of these patches, we reveal that they are outliers in Gaussian noise, and follow distinct distributions through two-sample tests. Finally, we find the misalignment between prompts and the trigger patch patterns can result in unsuccessful image generations. The study proposes a reject-sampling strategy to obtain optimal noise, aiming to improve prompt adherence and positional diversity in image generation. 
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End paper abstract -->

<div style="width: 70%; margin-left: 15%;">
  <p style="font-size: 24px; font-weight: bold;">How to locate Trigger patches: Post-generation Method</p>
</div>
<div style="width: 70%; margin: auto;">
  <p>We first propose a posterior analysis to identify and define trigger patches. Intuitively, we generate a bunch of images using the same noise and calculate a posterior metric called ``trigger entropy'' to measure the degree of dispersion of the object bounding boxes in the generated images. A lower entropy indicates a higher likelihood that a patch is a trigger patch, as shown in the firgure. Each row shows five images generated from one seed. The patch in the bottom row has the strongest effectiveness in inducing the generation of the object, while the objects in the top row are dispersed. So there must exist a strong trigger patch in the orange bounding box in the bottom row noise.</p>
</div>

<img src="static/images/Triggerentropy.png" alt="Illustration of Trigger Entropy" style="display: block; margin: auto; width:70%; height:auto;">

<div style="width: 70%; margin: auto;">
  <p>The entropy of the bounding box distribution is defined as:</p>
  <p>$\mathcal{H}(X) = \frac{1}{2} \left( \frac{1}{n} \sum_{i=1}^n (x_{c_i} - \bar{x}_c)^2 + \frac{1}{n} \sum_{i=1}^n (y_{c_i} - \bar{y}_c)^2 \right)$</p>
  <p>where $\: \bar{x}_c = \frac{1}{n} \sum_{i=1}^n x_{c_i},\: \bar{y}_c = \frac{1}{n} \sum_{i=1}^n y_{c_i}$, and $i$ is the box index.</p>
</div>


<div style="width: 70%; margin-left: 20%;">
  <p style="font-size: 24px; font-weight: bold;">How to locate Trigger patches: Pre-generation Method</p>
</div>

<div style="width: 70%; margin: auto;">
  <p>Given the generated images, we can locate the trigger patches by analyzing the dispersion of object bounding boxes across the images. We propose a posterior analysis technique to identify the trigger patches. Specifically, we calculate the entropy of the bounding box distribution to measure the dispersion of the objects. The entropy of the bounding box distribution is defined as:</p>
  <p>$\mathcal{H}(X) = \frac{1}{2} \left( \frac{1}{n} \sum_{i=1}^n (x_{c_i} - \bar{x}_c)^2 + \frac{1}{n} \sum_{i=1}^n (y_{c_i} - \bar{y}_c)^2 \right)$</p>
  <p>where $\: \bar{x}_c = \frac{1}{n} \sum_{i=1}^n x_{c_i},\: \bar{y}_c = \frac{1}{n} \sum_{i=1}^n y_{c_i}$, and $i$ is the box index.</p>
</div>



<!-- Image carousel -->
<!-- <section class="hero is-small">
  <div class="hero-body">
    <div class="container">
      <div id="results-carousel" class="carousel results-carousel">
       <div class="item">
        <img src="static/images/Picture.png" alt="MY ALT TEXT"/>
        <h2 class="subtitle has-text-centered">
          First image description.
        </h2>
      </div>
      <div class="item">
        <img src="static/images/carousel2.jpg" alt="MY ALT TEXT"/>
        <h2 class="subtitle has-text-centered">
          Second image description.
        </h2>
      </div>
      <div class="item">
        <img src="static/images/carousel3.jpg" alt="MY ALT TEXT"/>
        <h2 class="subtitle has-text-centered">
         Third image description.
       </h2>
     </div>
     <div class="item">
      <img src="static/images/carousel4.jpg" alt="MY ALT TEXT"/>
      <h2 class="subtitle has-text-centered">
        Fourth image description.
      </h2>
    </div>
  </div>
</div>
</div>
</section> -->
<!-- End image carousel -->


<!--BibTex citation -->
  <section class="section" id="BibTeX">
    <div class="container is-max-desktop content">
      <h2 class="title">BibTeX</h2>
      <pre><code>@article{ban2024crystal,
        title={The Crystal Ball Hypothesis in diffusion models: Anticipating object positions from initial noise},
        author={Ban, Yuanhao and Wang, Ruochen and Zhou, Tianyi and Gong, Boqing and Hsieh, Cho-Jui and Cheng, Minhao},
        journal={arXiv preprint arXiv:2406.01970},
        year={2024}
      }</code></pre>
    </div>
</section>
<!--End BibTex citation -->


  <footer class="footer">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">

          <p>
            This page was built using the <a href="https://github.com/eliahuhorwitz/Academic-project-page-template" target="_blank">Academic Project Page Template</a> which was adopted from theÂ <a href="https://nerfies.github.io" target="_blank">Nerfies</a>Â project page.
            You are free to borrow the of this website, we just ask that you link back to this page in the footer. <br> This website is licensed under a <a rel="license"  href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>

        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Statcounter tracking code -->
  
<!-- You can add a tracker to track page visits by creating an account at statcounter.com -->

    <!-- End of Statcounter Code -->

  </body>
  </html>
